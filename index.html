<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ‰«ç ç­¾åˆ°</title>
  <style>
    body { font-family: -apple-system, sans-serif; padding: 20px; max-width: 500px; margin: 0 auto; }
    input { width: 95%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
    button { width: 100%; padding: 14px; background: #3B82F6; color: white; border: none; border-radius: 6px; font-size: 16px; }
    #msg { margin-top: 15px; text-align: center; min-height: 24px; }
  </style>
</head>
<body>
  <h2>æ´»åŠ¨ç­¾åˆ°</h2>
  <form id="form">
    <input type="text" id="name" placeholder="è¯·è¾“å…¥å§“å" required />
    <input type="tel" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required />
    <button type="submit">ç«‹å³ç­¾åˆ°</button>
  </form>
  <div id="msg"></div>

<script>
  // ğŸ‘‡ æ›¿æ¢æˆä½ çš„ Supabase ä¿¡æ¯
  const SUPABASE_URL = 'https://jibgyawyvyihwqwrwdef.supabase.co'; // â† å¡«ä½ çš„ URL
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppYmd5YXd5dnlpaHdxd3J3ZGVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMDQwMzcsImV4cCI6MjA4MDc4MDAzN30.tQlHfVFxJNdqW0QkaBw4LiSUKWWyCcRL6kuJ84CCM6w'; // â† å¡«ä½ çš„ anon keyï¼ˆæ¥è‡ª Settings â†’ APIï¼‰

  document.getElementById('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const msgEl = document.getElementById('msg');

    if (!name || !phone) {
      msgEl.innerHTML = 'âŒ è¯·å¡«å†™å§“åå’Œæ‰‹æœºå·';
      return;
    }

    msgEl.innerHTML = 'æäº¤ä¸­...';

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/signups`, {
        method: 'POST',
        headers: {
          'apikey': SUPABASE_ANON_KEY,
          // âš ï¸ åˆ é™¤äº†è¿™è¡Œ â†“ï¼ˆä¸éœ€è¦ Authorizationï¼‰
          // 'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          'Prefer': 'return=minimal'
        },
        body: JSON.stringify({ name, phone })
      });

      if (res.ok) {
        msgEl.innerHTML = 'âœ… ç­¾åˆ°æˆåŠŸï¼';
        document.getElementById('form').reset();
      } else {
        const err = await res.json();
        const errorMsg = err.message || '';

        // âœ… æ£€æµ‹æ‰‹æœºå·é‡å¤ï¼ˆå”¯ä¸€çº¦æŸå†²çªï¼‰
        if (res.status === 409 && errorMsg.includes('signups_phone_key')) {
          msgEl.innerHTML = 'âŒ è¯¥äººå‘˜å·²ç­¾åˆ°ï¼Œè¯·ç¡®è®¤æ‰‹æœºå·';
        } else {
          // å…¶ä»–é”™è¯¯ï¼ˆå¦‚RLSæ‹’ç»ã€ç½‘ç»œé—®é¢˜ç­‰ï¼‰
          msgEl.innerHTML = 'âŒ æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•';
          console.error('Supabase error:', err);
        }
      }
    } catch (err) {
      console.error(err);
      msgEl.innerHTML = 'âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•';
    }
  });
</script>
</body>
</html>
